<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>App Store KR Top 10 – Daily Ranking</title>
  <meta name="description" content="매일 자동 업데이트되는 한국 앱스토어 인기 앱 Top 10." />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-800">
  <header class="sticky top-0 bg-white/80 backdrop-blur z-10 border-b">
    <div class="mx-auto max-w-4xl px-4 py-4 flex items-center justify-between">
      <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">App Store KR Top 10</h1>
      <div id="updatedAt" class="text-sm text-slate-500">로딩 중…</div>
    </div>
  </header>

  <main class="mx-auto max-w-4xl p-4">
    <p class="text-slate-600 mb-4">공식 iTunes RSS 피드 기반. 매일 오전 8시(KST) 자동 갱신.</p>
    <ol id="list" class="divide-y rounded-2xl border bg-white shadow-sm"></ol>
    <p class="mt-6 text-xs text-slate-500">* 본 페이지는 순위/메타데이터만 표기하며, 불법 콘텐츠와 무관합니다.</p>
  </main>

  <footer class="mx-auto max-w-4xl p-6 text-center text-xs text-slate-400">
    © <span id="year"></span> Daily Rankings. All rights reserved.
  </footer>

  <script>
    const listEl = document.getElementById('list');
    const updatedAtEl = document.getElementById('updatedAt');
    document.getElementById('year').textContent = new Date().getFullYear();

    async function load() {
      try {
        const res = await fetch('./data/appstore-kr.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('Failed to load JSON');
        const data = await res.json();
        render(data);
      } catch (e) {
        console.error(e);
        // fallback demo
        render({
          updatedAt: new Date().toISOString(),
          items: [
            { rank: 1, title: '데모 앱 1', artist: '회사 A', category: '게임', url: '#', icon: '', rating: 4.7, ratings: 12000, price: '무료' },
            { rank: 2, title: '데모 앱 2', artist: '회사 B', category: '생산성', url: '#', icon: '', rating: 4.5, ratings: 8500, price: '₩1,000' }
          ]
        });
      }
    }

    function render({ updatedAt, items }) {
      updatedAtEl.textContent = `업데이트: ${new Date(updatedAt).toLocaleString('ko-KR')}`;
      listEl.innerHTML = '';

      items.slice(0, 10).forEach(it => {
        const li = document.createElement('li');
        li.className = 'flex items-center gap-4 p-4';
        li.innerHTML = `
          <div class="w-10 text-right text-lg font-semibold tabular-nums">${it.rank}</div>
          <div class="w-12 h-12 rounded-xl overflow-hidden bg-slate-100 flex-shrink-0">
            ${it.icon ? `<img src="${it.icon}" alt="${it.title}" class="w-full h-full object-cover" />` : ''}
          </div>
          <div class="flex-1 min-w-0">
            <a href="${it.url}" target="_blank" rel="noreferrer noopener" class="font-medium hover:underline truncate block">${it.title}</a>
            <div class="text-sm text-slate-500 truncate">${it.artist} · ${it.category}</div>
            <div class="text-xs text-slate-500">${it.price ?? '무료'}</div>
          </div>
        `;
        listEl.appendChild(li);
      });
    }

    load();
  </script>
</body>
</html>
