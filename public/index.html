<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>App Store KR Top 10 – Daily Ranking</title>
  <meta name="description" content="매일 자동 업데이트되는 한국 앱스토어 인기 앱 Top 10." />
  <!-- Tailwind (간편용) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-800">
  <header class="sticky top-0 bg-white/80 backdrop-blur z-10 border-b">
    <div class="mx-auto max-w-4xl px-4 py-4 flex items-center justify-between">
      <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">App Store KR Top 10</h1>
      <div id="updatedAt" class="text-sm text-slate-500">로딩 중…</div>
    </div>
  </header>

  <main class="mx-auto max-w-4xl p-4">
    <p class="text-slate-600 mb-4">
      공식 iTunes RSS 기반. (현재 저장소 루트에서 배포 중)
      <br />실제 데이터를 쓰려면 <code>data/appstore-kr.json</code> 파일을 올려주세요.
    </p>

    <ol id="list" class="divide-y rounded-2xl border bg-white shadow-sm"></ol>

    <p class="mt-6 text-xs text-slate-500">
      * 본 페이지는 순위/메타데이터만 표기하며, 불법 콘텐츠와 무관합니다.
    </p>
  </main>

  <footer class="mx-auto max-w-4xl p-6 text-center text-xs text-slate-400">
    © <span id="year"></span> Daily Rankings. All rights reserved.
  </footer>

  <script>
    const listEl = document.getElementById('list');
    const updatedAtEl = document.getElementById('updatedAt');
    document.getElementById('year').textContent = new Date().getFullYear();

    async function load() {
      try {
        // 루트 배포이므로 ./data 경로 사용
        const res = await fetch('./data/appstore-kr.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('no json yet');
        const data = await res.json();
        render(data);
      } catch (e) {
        // JSON이 아직 없을 때는 데모 데이터로 표시
        render({
          updatedAt: new Date().toISOString(),
          items: [
            { rank: 1, title: '데모 앱 1', artist: '회사 A', category: '게임', url: '#', icon: '', price: '무료' },
            { rank: 2, title: '데모 앱 2', artist: '회사 B', category: '생산성', url: '#', icon: '', price: '₩1,000' },
            { rank: 3, title: '데모 앱 3', artist: '회사 C', category: '유틸리티', url: '#', icon: '', price: '무료' },
            { rank: 4, title: '데모 앱 4', artist: '회사 D', category: '엔터테인먼트', url: '#', icon: '', price: '무료' },
            { rank: 5, title: '데모 앱 5', artist: '회사 E', category: '라이프스타일', url: '#', icon: '', price: '무료' },
            { rank: 6, title: '데모 앱 6', artist: '회사 F', category: '사진/영상', url: '#', icon: '', price: '무료' },
            { rank: 7, title: '데모 앱 7', artist: '회사 G', category: '소셜 네트워킹', url: '#', icon: '', price: '무료' },
            { rank: 8, title: '데모 앱 8', artist: '회사 H', category: '비즈니스', url: '#', icon: '', price: '무료' },
            { rank: 9, title: '데모 앱 9', artist: '회사 I', category: '교육', url: '#', icon: '', price: '무료' },
            { rank: 10, title: '데모 앱 10', artist: '회사 J', category: '여행', url: '#', icon: '', price: '무료' }
          ]
        });
      }
    }

    function render({ updatedAt, items }) {
      updatedAtEl.textContent = `업데이트: ${new Date(updatedAt).toLocaleString('ko-KR')}`;
      listEl.innerHTML = '';

      items.slice(0, 10).forEach(it => {
        const li = document.createElement('li');
        li.className = 'flex items-center gap-4 p-4';
        li.innerHTML = `
          <div class="w-10 text-right text-lg font-semibold tabular-nums">${it.rank}</div>
          <div class="w-12 h-12 rounded-xl overflow-hidden bg-slate-100 flex-shrink-0">
            ${it.icon ? `<img src="${it.icon}" alt="${it.title}" class="w-full h-full object-cover" />` : ''}
          </div>
          <div class="flex-1 min-w-0">
            <a href="${it.url}" target="_blank" rel="noreferrer noopener" class="font-medium hover:underline truncate block">${it.title}</a>
            <div class="text-sm text-slate-500 truncate">${it.artist || ''} ${it.category ? '· ' + it.category : ''}</div>
            <div class="text-xs text-slate-500">${it.price ?? '무료'}</div>
          </div>
        `;
        listEl.appendChild(li);
      });
    }

    load();
  </script>
</body>
</html>
